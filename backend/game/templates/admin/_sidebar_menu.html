    <div class="sidebar-menu-wrapper">
        {% if is_super_admin or admin_permissions.can_view_dashboard or admin_permissions.can_control_dice or admin_permissions.can_view_recent_rounds or admin_permissions.can_view_all_bets %}
        <div class="menu-section">
            <div style="padding: 0 20px 10px 20px; display: flex; align-items: center; justify-content: space-between;">
                <span class="menu-section-title" style="padding: 0; margin: 0;">MAIN</span>
                <button id="test-sound-btn" title="Test Notification Sound" style="background: transparent; border: 1px solid rgba(255,255,255,0.2); color: rgba(255,255,255,0.6); padding: 2px 8px; border-radius: 4px; font-size: 10px; cursor: pointer; transition: all 0.2s;">
                    üîî Test
                </button>
            </div>
            <ul class="sidebar-menu">
            {% if is_super_admin or admin_permissions.can_view_dashboard %}
            <li><a href="{% url 'admin_dashboard' %}" {% if page == 'dashboard' %}class="active"{% endif %}>
                <span class="menu-icon">üè†</span> Dashboard
            </a></li>
            {% endif %}
            
            {% if is_super_admin or admin_permissions.can_control_dice %}
            <li><a href="{% url 'dice_control' %}" {% if page == 'dice-control' %}class="active"{% endif %}>
                <span class="menu-icon">üéØ</span> Dice Control
            </a></li>
            {% endif %}
            
            {% if is_super_admin or admin_permissions.can_view_recent_rounds %}
            <li><a href="{% url 'recent_rounds' %}" {% if page == 'recent-rounds' or page == 'rounds' or page == 'round-details' or page == 'user-details' %}class="active"{% endif %}>
                <span class="menu-icon">üîÑ</span> Recent Rounds
            </a></li>
            {% endif %}
            
            {% if is_super_admin or admin_permissions.can_view_all_bets %}
            <li><a href="{% url 'all_bets' %}" {% if page == 'all-bets' %}class="active"{% endif %}>
                <span class="menu-icon">üí∞</span> All Bets
            </a></li>
            {% endif %}
        </ul>
    </div>
    {% endif %}
    
    {% if is_super_admin or admin_permissions.can_view_wallets or admin_permissions.can_view_deposit_requests or admin_permissions.can_view_withdraw_requests or admin_permissions.can_view_transactions %}
    <div class="menu-section">
        <div class="menu-section-title">MONEY MOVEMENT</div>
        <ul class="sidebar-menu">
            {% if is_super_admin or admin_permissions.can_view_wallets %}
            <li><a href="{% url 'wallets' %}" {% if page == 'wallets' %}class="active"{% endif %}>
                <span class="menu-icon">üí≥</span> Wallets
            </a></li>
            {% endif %}
            
            {% if is_super_admin or admin_permissions.can_view_deposit_requests %}
            <li><a href="{% url 'deposit_requests' %}" {% if page == 'deposit-requests' %}class="active"{% endif %}>
                <span class="menu-icon">üíé</span> Deposit Requests
            </a></li>
            {% endif %}

            {% if is_super_admin or admin_permissions.can_view_withdraw_requests %}
            <li><a href="{% url 'withdraw_requests' %}" {% if page == 'withdraw-requests' %}class="active"{% endif %}>
                <span class="menu-icon">üí∏</span> Withdraw Requests
            </a></li>
            {% endif %}
            
            {% if is_super_admin or admin_permissions.can_view_transactions %}
            <li><a href="{% url 'admin_transactions' %}" {% if page == 'transactions' %}class="active"{% endif %}>
                <span class="menu-icon">üìä</span> Reports
            </a></li>
            {% endif %}
        </ul>
    </div>
    {% endif %}
    
    {% if is_super_admin or admin_permissions.can_view_players or admin_permissions.can_view_admin_management or admin_permissions.can_view_game_settings or admin_permissions.can_manage_payment_methods %}
    <div class="menu-section">
        <div class="menu-section-title">SYSTEM</div>
        <ul class="sidebar-menu">
            {% if is_super_admin or admin_permissions.can_view_players %}
            <li><a href="{% url 'manage_players' %}" {% if page == 'manage-players' %}class="active"{% endif %}>
                <span class="menu-icon">üë•</span> Players
            </a></li>
            {% endif %}
            
            {% if is_super_admin or admin_permissions.can_view_admin_management %}
    <li><a href="{% url 'players' %}" {% if page == 'players' %}class="active"{% endif %}>
        <span class="menu-icon">üë®‚Äçüíº</span> Admin Management
    </a></li>
    {% endif %}

            {% if is_super_admin or admin_permissions.can_view_game_settings %}
            <li><a href="{% url 'game_settings' %}" {% if page == 'game_settings' %}class="active"{% endif %}>
                <span class="menu-icon">‚öôÔ∏è</span> Game Settings
            </a></li>
            {% endif %}

            {% if is_super_admin or admin_permissions.can_manage_payment_methods %}
            <li><a href="{% url 'payment_methods' %}" {% if page == 'payment-methods' %}class="active"{% endif %}>
                <span class="menu-icon">üè¶</span> Payment Methods
            </a></li>
            {% endif %}
            
        </ul>
    </div>
    {% endif %}
</div>
</div>

<!-- Admin Real-time Notifications -->
<style>
    /* Global Notification Popup Styles */
    .notification-popup {
        position: fixed;
        top: 24px;
        right: 24px;
        background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
        color: white;
        padding: 20px 24px;
        border-radius: 16px;
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1);
        z-index: 100000;
        min-width: 320px;
        max-width: 420px;
        animation: slideInRight 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        cursor: pointer;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }

    .notification-popup.deposit {
        background: linear-gradient(135deg, #059669 0%, #10b981 100%);
        box-shadow: 0 20px 50px rgba(16, 185, 129, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.2);
    }

    .notification-popup.withdraw {
        background: linear-gradient(135deg, #d97706 0%, #f59e0b 100%);
        box-shadow: 0 20px 50px rgba(245, 158, 11, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.2);
    }

    @keyframes slideInRight {
        from { transform: translateX(120%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }

    .notification-popup.hide {
        animation: slideOutRight 0.4s cubic-bezier(0.6, -0.28, 0.735, 0.045) forwards;
    }

    @keyframes slideOutRight {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(120%); opacity: 0; }
    }

    .notification-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 14px;
    }

    .notification-title {
        font-size: 18px;
        font-weight: 800;
        display: flex;
        align-items: center;
        gap: 10px;
        letter-spacing: -0.02em;
    }

    .notification-close {
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        width: 28px;
        height: 28px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
    }

    .notification-close:hover {
        background: rgba(255, 255, 255, 0.4);
        transform: scale(1.1);
    }

    .notification-body {
        font-size: 15px;
        line-height: 1.5;
    }

    .notification-user {
        font-weight: 700;
        font-size: 17px;
        display: block;
        margin-bottom: 6px;
        opacity: 0.95;
    }

    .notification-amount {
        font-size: 28px;
        font-weight: 900;
        margin: 10px 0;
        display: block;
        letter-spacing: -0.03em;
    }

    .notification-time {
        font-size: 12px;
        opacity: 0.8;
        display: block;
        margin-top: 10px;
        text-align: right;
        font-weight: 500;
    }
</style>
<script>
    (function() {
        let notificationSocket = null;
        let reconnectAttempts = 0;
        const maxReconnects = 5;
        let audioContext = null;

        // Initialize audio context on first user interaction to bypass browser restrictions
        function initAudio() {
            if (audioContext && audioContext.state !== 'closed') return;
            try {
                const AudioContextClass = window.AudioContext || window.webkitAudioContext;
                audioContext = new AudioContextClass();
                console.log('üîî [System] Audio Context initialized');
                
                // Keep the context alive by playing a silent buffer on a loop
                const buffer = audioContext.createBuffer(1, 1, 22050);
                const source = audioContext.createBufferSource();
                source.buffer = buffer;
                source.connect(audioContext.destination);
                source.loop = true;
                source.start(0);
            } catch (e) {
                console.error('üîî [Error] Failed to initialize Audio Context:', e);
            }
        }

        // Add listeners to unlock audio on first click/touch
        ['click', 'touchstart', 'keydown'].forEach(event => {
            document.addEventListener(event, function() {
                if (!audioContext) initAudio();
                if (audioContext && audioContext.state === 'suspended') {
                    audioContext.resume().then(() => {
                        console.log('üîî [System] Audio Context resumed');
                    });
                }
            }, { once: true });
        });

        function playNotificationSound(type) {
            try {
                if (!audioContext || audioContext.state === 'closed') initAudio();
                if (!audioContext) return;
                
                // CRITICAL: Always try to resume before playing
                audioContext.resume().then(() => {
                    const now = audioContext.currentTime;

                    function playAlert(freq, start, duration, vol, wave) {
                        const osc = audioContext.createOscillator();
                        const gain = audioContext.createGain();
                        
                        osc.type = wave || 'triangle';
                        osc.frequency.setValueAtTime(freq, now + start);
                        
                        gain.gain.setValueAtTime(0, now + start);
                        gain.gain.linearRampToValueAtTime(vol, now + start + 0.02);
                        gain.gain.linearRampToValueAtTime(vol * 0.8, now + start + duration - 0.05);
                        gain.gain.exponentialRampToValueAtTime(0.01, now + start + duration);
                        
                        osc.connect(gain);
                        gain.connect(audioContext.destination);
                        
                        osc.start(now + start);
                        osc.stop(now + start + duration);
                    }

                    if (type === 'deposit') {
                        // MAX INTENSITY SIREN - Extreme Volume
                        const vol = 5.0; 
                        playAlert(1000, 0, 0.1, vol, 'square');
                        playAlert(1500, 0.1, 0.1, vol, 'square');
                        playAlert(1000, 0.2, 0.1, vol, 'square');
                        playAlert(1500, 0.3, 0.1, vol, 'square');
                        playAlert(2000, 0.4, 0.8, vol * 1.5, 'square'); // Final high-pitch blast
                    } else {
                        // MAX INTENSITY ALERT - Extreme Volume
                        const vol = 4.0;
                        playAlert(800, 0, 0.3, vol, 'sawtooth');
                        playAlert(1200, 0.3, 0.7, vol, 'sawtooth');
                    }
                });
            } catch (e) {
                console.log('Audio notification failed:', e);
            }
        }

        function showAdminNotification(data) {
            const container = document.body;
            const notification = document.createElement('div');
            const type = data.notification_type || 'info';
            notification.className = `notification-popup ${type}`;
            
            const icon = type === 'deposit' ? 'üí∞' : 'üí∏';
            const title = type === 'deposit' ? 'New Deposit Request' : 'New Withdraw Request';
            const redirectUrl = type === 'deposit' ? '{% url "deposit_requests" %}' : '{% url "withdraw_requests" %}';

            notification.innerHTML = `
                <div class="notification-header">
                    <div class="notification-title">
                        <span>${icon}</span>
                        <span>${title}</span>
                    </div>
                    <button class="notification-close">&times;</button>
                </div>
                <div class="notification-body">
                    <span class="notification-user">User: ${data.user}</span>
                    <span class="notification-amount">‚Çπ${parseFloat(data.amount).toFixed(2)}</span>
                    <span class="notification-time">${data.created_at || new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                </div>
            `;

            container.appendChild(notification);
            playNotificationSound(type);

            // Close button
            notification.querySelector('.notification-close').addEventListener('click', (e) => {
                e.stopPropagation();
                notification.classList.add('hide');
                setTimeout(() => notification.remove(), 400);
            });

            // Click to view
            notification.addEventListener('click', () => {
                window.location.href = redirectUrl;
            });

            // Auto-hide after 15 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.classList.add('hide');
                    setTimeout(() => notification.remove(), 400);
                }
            }, 15000);
        }

        // Test sound button listener
        document.addEventListener('DOMContentLoaded', () => {
            const testBtn = document.getElementById('test-sound-btn');
            if (testBtn) {
                testBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    playNotificationSound('deposit');
                    
                    // Visual feedback
                    const originalText = testBtn.innerText;
                    testBtn.innerText = 'üîä Playing...';
                    testBtn.style.color = '#fff';
                    testBtn.style.borderColor = '#fff';
                    setTimeout(() => {
                        testBtn.innerText = originalText;
                        testBtn.style.color = 'rgba(255,255,255,0.6)';
                        testBtn.style.borderColor = 'rgba(255,255,255,0.2)';
                    }, 1000);
                });
            }
        });

        function connectNotificationSocket() {
            // Use current hostname for WebSocket connection
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            // Use port 8004 if on localhost to match the user's environment
            const host = window.location.hostname === 'localhost' ? 'localhost:8004' : window.location.host;
            const wsUrl = `${protocol}//${host}/ws/game/`;
            
            console.log('üîî [System] Connecting to Notification WebSocket:', wsUrl);
            
            try {
                notificationSocket = new WebSocket(wsUrl);
                
                notificationSocket.onopen = function() {
                    console.log('üîî [System] Notification WebSocket connected');
                    reconnectAttempts = 0;
                };
                
                notificationSocket.onmessage = function(e) {
                    try {
                        const data = JSON.parse(e.data);
                        console.log('üîî [System] Received real-time event:', data);
                        
                        if (data.type === 'admin_notification') {
                            console.log('üîî [System] Processing admin notification');
                            showAdminNotification(data);
                            
                            // Dispatch a custom event so specific pages can update their UI
                            const event = new CustomEvent('adminNotification', { 
                                detail: data,
                                bubbles: true,
                                cancelable: true
                            });
                            window.dispatchEvent(event);
                        }
                    } catch (err) {
                        console.error('üîî [Error] Parsing notification data:', err);
                    }
                };
                
                notificationSocket.onclose = function(e) {
                    console.warn('üîî [System] Notification WebSocket closed. Code:', e.code, 'Reason:', e.reason);
                    if (reconnectAttempts < maxReconnects) {
                        reconnectAttempts++;
                        const delay = 2000 * reconnectAttempts;
                        console.log(`üîî [System] Retrying connection in ${delay}ms... (Attempt ${reconnectAttempts}/${maxReconnects})`);
                        setTimeout(connectNotificationSocket, delay);
                    } else {
                        console.error('üîî [Critical] Max WebSocket reconnection attempts reached.');
                    }
                };

                notificationSocket.onerror = function(err) {
                    console.error('üîî [Error] WebSocket encounterd an error');
                };
            } catch (err) {
                console.error('üîî [Error] Failed to create WebSocket connection:', err);
            }
        }

        // Only connect if user is an admin
        {% if user.is_staff %}
        connectNotificationSocket();
        {% endif %}
    })();
</script>
